<!doctype html>
<html>
<head>
    <title>Brython interactive mode</title>
    <meta charset="UTF-8">
    <meta name=robots content="index, follow">
    <meta name=description content=Brython >
    <meta name=author content="Pierre Quentel">
    <meta name=keywords content="Python, Brython">
    <meta name=viewport content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" type="image/png" href="favicon.png" />
    <noscript>Please enable Javascript to view this page correctly.</noscript>

    <link rel=stylesheet href="brython.css">

    <script src="src/brython.js"></script>

    <script>
      //if (window.birdbrain === undefined) {
        window.birdbrain = {};
        window.birdbrain.sensorData = {};
        window.birdbrain.sensorData.A = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        window.birdbrain.sensorData.B = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        window.birdbrain.sensorData.C = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        window.birdbrain.robotType = {
          FINCH: 1,
          HUMMINGBIRDBIT: 2,
          MICROBIT: 3,
          //connected robots default to type MICROBIT
          A: 3,
          B: 3,
          C: 3
        };

        console.log("setting up message channel")
        window.birdbrain.messageChannel = new MessageChannel();
        window.birdbrain.messageChannel.port1.onmessage = function (e) {
            console.log("Got a message: ");
            console.log(e.data);
            if (e.data.sensorData != null && e.data.robot != null) {
              let robot = e.data.robot;
              window.birdbrain.sensorData[robot] = e.data.sensorData;
              window.birdbrain.robotType[robot] = e.data.robotType;
            }
        }
        window.parent.postMessage("hello from snap", "*", [window.birdbrain.messageChannel.port2]);

        window.birdbrain.sendCommand = function(command) {
          window.parent.postMessage(command, "*");
        }
      //}
    </script>

    <style>
    .codearea {
        background-color:#000;
        color:#fff;
        font-family:'Oxygen Mono', Consolas, 'Liberation Mono', 'DejaVu Sans Mono', monospace;
        font-size:14px;
        overflow:auto
    }
    div, textarea {
        height:100%;
        width:98%
    }
    </style>
</head>


<body onload="brython(1)">

    <textarea id=code class=codearea rows=20></textarea>

    <div id=content></div>

    <script type="text/python3" src="console.py"></script>

</body>

</html>
